<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Blackjack — Mini Juegos (Moderno)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0f1724;
    --card:#0b1220;
    --glass: rgba(255,255,255,0.04);
    --glass-2: rgba(255,255,255,0.03);
    --glass-border: rgba(255,255,255,0.06);
    --muted: rgba(255,255,255,0.65);
    --accent1-start:#7c3aed;
    --accent1-end:#06b6d4;
    --accent2-start:#f59e0b;
    --accent2-end:#ef4444;
    --success:#10b981;
    --danger:#ef4444;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background:
      radial-gradient(800px 400px at 10% 10%, rgba(124,58,237,0.06), transparent 10%),
      radial-gradient(700px 350px at 90% 80%, rgba(6,182,212,0.04), transparent 10%),
      var(--bg);
    color:#e6eef8;
    -webkit-font-smoothing:antialiased;
    padding:28px;
  }

  .container{max-width:1200px;margin:0 auto}

  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:48px;height:48px;border-radius:12px;background:linear-gradient(135deg,#071025,#0b1220);display:grid;place-items:center;border:1px solid rgba(255,255,255,0.03)}
  h1{font-size:18px;margin:0}
  p.sub{margin:0;color:var(--muted);font-size:13px}

  main{display:grid;grid-template-columns:1fr 360px;gap:22px;align-items:start}

  /* Table/Game Card */
  .game-card{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:16px;padding:18px;border:1px solid var(--glass-border);
    box-shadow: 0 10px 30px rgba(2,6,23,0.6);
  }
  .top-row{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
  .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .select, .input {
    background:var(--glass);border:1px solid var(--glass-border);padding:10px 12px;border-radius:10px;color:inherit;
  }
  .btn{
    padding:10px 14px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--accent1-start),var(--accent1-end));
    color:white;font-weight:700;cursor:pointer;box-shadow:0 8px 30px rgba(124,58,237,0.14);
  }
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);box-shadow:none;color:var(--muted)}
  .btn.warn{background:linear-gradient(90deg,var(--accent2-start),var(--accent2-end));box-shadow:0 8px 30px rgba(245,158,11,0.12)}
  .btn[disabled]{opacity:.5;cursor:not-allowed}

  .table-wrap{display:grid;grid-template-columns:1fr;gap:12px}
  .bj-table{
    background: radial-gradient(1200px 400px at 50% 120%, rgba(124,58,237,0.08), transparent 40%),
                radial-gradient(900px 400px at 50% -60%, rgba(6,182,212,0.06), transparent 40%),
                linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid var(--glass-border); border-radius:16px; padding:20px; position:relative;
    min-height:420px; display:flex; flex-direction:column; justify-content:space-between;
  }
  .hands{display:grid;grid-template-rows:auto 1fr auto;row-gap:16px}
  .dealer-area, .player-area{display:flex;flex-direction:column;gap:6px}
  .label{font-size:12px;color:var(--muted)}

  .hand{display:flex;align-items:flex-end;gap:8px;min-height:106px;flex-wrap:wrap}
  .card{width:64px;height:94px;border-radius:10px;background:linear-gradient(180deg,#0c1426,#091022);border:1px solid rgba(255,255,255,0.06);position:relative;box-shadow:0 12px 30px rgba(2,6,23,.5);display:grid;place-items:center;transform:translateY(8px);opacity:0}
  .card.show{transform:translateY(0);opacity:1;transition:transform .25s ease, opacity .25s ease}
  .card .rank{position:absolute;top:8px;left:10px;font-weight:800}
  .card .suit{position:absolute;bottom:8px;right:10px;font-size:18px}
  .card.face{background:linear-gradient(135deg,#111a33,#0c1426);}
  .card.back{background:linear-gradient(135deg,#1b2741,#131b2f); border:1px solid rgba(255,255,255,0.12)}
  .card.black{color:#e6eef8}
  .card.red{color:#fca5a5}

  .value-badge{display:inline-flex;align-items:center;gap:6px;background:var(--glass);border:1px solid var(--glass-border);padding:6px 10px;border-radius:999px;font-size:12px}
  .value-badge.good{background:rgba(16,185,129,0.15)}
  .value-badge.bust{background:rgba(239,68,68,0.15)}
  .value-badge.blackjack{background:linear-gradient(90deg,var(--accent1-start),var(--accent1-end));color:#fff}

  .chip-row{display:flex;gap:8px;flex-wrap:wrap}
  .chip{min-width:52px;padding:10px 12px;border-radius:999px;background:var(--glass);border:1px solid var(--glass-border);cursor:pointer}
  .chip.active{outline:2px solid rgba(124,58,237,.45)}

  .actions{display:flex;gap:10px;flex-wrap:wrap}

  .panel{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:16px;padding:18px;border:1px solid var(--glass-border);height:100%;
    position:sticky;top:28px;
  }
  .stat{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;margin-bottom:8px;background:var(--glass-2);border:1px solid rgba(255,255,255,0.02)}
  .stat strong{font-size:16px}
  .small{color:var(--muted);font-size:13px}
  .footer-note{margin-top:12px;color:var(--muted);font-size:13px;text-align:center}

  .ribbon{position:absolute;top:12px;left:50%;transform:translateX(-50%);padding:8px 12px;border-radius:999px;background:rgba(255,255,255,0.06);border:1px solid var(--glass-border);font-size:12px}

  /* responsive */
  @media (max-width:980px){
    main{grid-template-columns:1fr}
    .panel{position:relative;top:auto}
  }
</style>
</head>
<body>
<div class="container">
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none"><path d="M12 3L21 9L16 21H8L3 9L12 3Z" stroke="url(#g1)" stroke-width="1.2" stroke-linejoin="round"/><defs><linearGradient id="g1" x1="0" x2="1"><stop offset="0" stop-color="#7c3aed"/><stop offset="1" stop-color="#06b6d4"/></linearGradient></defs></svg>
      </div>
      <div>
        <h1>Blackjack — Mini Juegos</h1>
        <p class="sub">Estilo profesional — 6 mazos, acciones avanzadas (Doblar, Dividir, Seguro, Rendirse).</p>
      </div>
    </div>
    <div class="controls">
      <div style="background:var(--glass);padding:8px 12px;border-radius:999px;border:1px solid var(--glass-border);display:flex;gap:8px;align-items:center">
        <div style="width:10px;height:10px;border-radius:50%;background:linear-gradient(90deg,#34d399,#10b981)"></div>
        <div id="balanceLabel" style="font-weight:700">0.500 BTC</div>
        <div style="font-size:12px;color:var(--muted)">Balance</div>
      </div>
    </div>
  </header>

  <main>
    <section class="game-card" aria-labelledby="gameTitle">
      <div class="top-row">
        <div>
          <div style="display:flex;gap:8px;align-items:center">
            <h2 id="gameTitle" style="margin:0;font-size:16px">Blackjack Clásico 3:2</h2>
            <div class="small" style="margin-left:6px">6 mazos • Dealer se planta en 17 suave • Rebaraja al 75%</div>
          </div>
          <div class="small" style="margin-top:6px">Ajusta tu apuesta, presiona <strong>Repartir</strong> y juega. Diseño mockup sin pagos reales.</div>
        </div>
        <div class="controls">
          <input id="betInput" class="input" type="number" min="0.0001" step="0.0001" value="0.01" title="Apuesta (BTC)" />
          <div class="chip-row" aria-label="Chips">
            <button class="chip" data-chip="0.001">0.001</button>
            <button class="chip" data-chip="0.005">0.005</button>
            <button class="chip active" data-chip="0.01">0.01</button>
            <button class="chip" data-chip="0.05">0.05</button>
            <button class="chip" data-chip="0.1">0.1</button>
          </div>
          <button id="dealBtn" class="btn">Repartir</button>
        </div>
      </div>

      <div class="table-wrap">
        <div class="bj-table" id="table">
          <div class="ribbon" id="shoeInfo">Shoe: 6 mazos • Quedan 0%</div>

          <div id="winnerMessage" style="display:none;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(17,24,39,0.85);padding:24px 40px;border-radius:16px;border:1px solid rgba(255,255,255,0.1);font-size:20px;font-weight:700;color:white;box-shadow:0 10px 40px rgba(0,0,0,0.5);z-index:50;">¡Ganaste!</div>
<div class="hands">
            <div class="dealer-area">
              <div class="label">Crupier <span id="dealerValue" class="value-badge">-</span></div>
              <div class="hand" id="dealerHand"></div>
            </div>

            <div class="player-area">
              <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
                <div class="label">Jugador <span id="playerValue" class="value-badge">-</span> <span id="handIndexLabel" class="small" style="margin-left:8px"></span></div>
                <div class="actions">
                  <button id="hitBtn" class="btn ghost" disabled>Pedir</button>
                  <button id="standBtn" class="btn ghost" disabled>Plantarse</button>
                  <button id="doubleBtn" class="btn ghost" disabled>Doblar</button>
                  <button id="splitBtn" class="btn ghost" disabled>Dividir</button>
                  <button id="surrenderBtn" class="btn ghost" disabled>Rendirse</button>
                  <button id="insureBtn" class="btn ghost" disabled>Seguro</button>
                </div>
              </div>
              <div class="hand" id="playerHands"></div>
            </div>

            <div>
              <div class="label">Resultados</div>
              <div id="lastResult" class="small" style="padding:8px;border-radius:10px;border:1px solid var(--glass-border);background:var(--glass-2)">Sin historial</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <aside>
      <div class="panel">
        <h4 style="margin:0 0 8px">Panel</h4>
        <div class="stat"><div class="small">Estado</div><strong id="stateLabel">Apostando</strong></div>
        <div class="stat"><div class="small">Apuesta</div><strong id="betLabel">0.0100 BTC</strong></div>
        <div class="stat"><div class="small">Seguro</div><strong id="insLabel">-</strong></div>
        <div class="stat"><div class="small">Pago previsto</div><strong id="payoutLabel">-</strong></div>
        <div class="stat"><div class="small">Partidas</div><strong id="roundsLabel">0</strong></div>
        <div class="stat"><div class="small">W / L / D</div><strong id="wldLabel">0 / 0 / 0</strong></div>
        <div class="stat"><div class="small">RTP Sim.</div><strong id="rtpLabel">-</strong></div>
        <div style="display:flex;gap:10px;margin-top:12px">
          <button id="newShoeBtn" class="btn warn ghost" style="flex:1">Nuevo Shoe</button>
          <button id="resetBtn" class="btn ghost" style="flex:1">Reiniciar</button>
        </div>
        <div class="footer-note" style="margin-top:12px">Reglas: BJ paga 3:2. Dealer se planta en 17 suave (A+6). Doble tras split permitido una vez. Dividir máx 1 vez (2 manos). Rendirse tardío permitido.</div>
      </div>
    </aside>
  </main>
</div>






<script>
(function(){
  const STORAGE_KEY = 'casino_balance_ARS';
  const DEFAULT_BAL = 1000;
  const ADMIN_PATH = './admin.json';
  const POLL_INTERVAL_MS = 5000; // poll admin.json every 5 seconds for changes

  // Helpers
  function toNumber(v){
    if (v === null || v === undefined) return 0;
    v = String(v).replace(/[^\d\.,-]/g,'').trim();
    v = v.replace(/\.(?=.*\.)/g,'').replace(/,(?=.*\,)/g,'');
    v = v.replace(',', '.');
    const n = parseFloat(v);
    return isNaN(n)?0:n;
  }
  function formatARS(n){
    if (Math.abs(Math.round(n) - n) < 1e-9) return Math.round(n).toLocaleString('es-AR');
    return n.toLocaleString('es-AR', {minimumFractionDigits:2, maximumFractionDigits:2});
  }

  function readStoredBalance(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(raw !== null) return Number(raw);
    }catch(e){}
    return null;
  }
  function writeStoredBalance(v){
    try{
      localStorage.setItem(STORAGE_KEY, String(Number(v)||0));
      updateAllDisplays();
    }catch(e){}
  }

  // Fetch admin.json and apply if different
  let lastAdminRaw = null;
  function fetchAndApplyAdmin(){
    return fetch(ADMIN_PATH, {cache:'no-store'}).then(r=>{
      if(!r.ok) throw new Error('no admin');
      return r.text();
    }).then(txt=>{
      if(txt === lastAdminRaw) return null; // no change
      lastAdminRaw = txt;
      try{
        const cfg = JSON.parse(txt);
        const b = (cfg && typeof cfg.balance_ARS !== 'undefined')? Number(cfg.balance_ARS) : DEFAULT_BAL;
        writeStoredBalance(b);
        return b;
      }catch(e){
        // invalid JSON
        return null;
      }
    }).catch(err=>{
      if(readStoredBalance() === null) writeStoredBalance(DEFAULT_BAL);
      return null;
    });
  }

  // Text node sanitizer similar to before
  function sanitizeTextNode(node){
    if(!node || !node.nodeValue) return;
    let txt = node.nodeValue;
    if(/BTC/i.test(txt) || /([0-9\.,]+)\s*(BTC|btc)/i.test(txt)){
      const bal = readStoredBalance() ?? DEFAULT_BAL;
      txt = txt.replace(/([0-9\.,]+)\s*(BTC|btc)/ig, function(_,num){ return formatARS(bal) + ' ARS'; });
      txt = txt.replace(/BTC/ig, 'ARS');
      node.nodeValue = txt;
    }
  }

  function updateAllDisplays(){
    const bal = Number(localStorage.getItem(STORAGE_KEY)) || 0;
    const selectors = [
      '#balance', '#saldo', '#balanceLabel', '.balance', '.saldo', '.user-balance', '.balance-value'
    ];
    selectors.forEach(sel=>{
      document.querySelectorAll(sel).forEach(el=>{
        if(el.tagName === 'INPUT' || el.tagName === 'TEXTAREA'){
          el.value = formatARS(bal);
        } else {
          el.textContent = formatARS(bal) + ' ARS';
        }
      });
    });
    walkTextNodes(document.body, sanitizeTextNode);
  }

  function walkTextNodes(node, fn){
    const walker = document.createTreeWalker(node, NodeFilter.SHOW_TEXT, null, false);
    let n;
    while(n = walker.nextNode()){
      fn(n);
    }
  }

  const observer = new MutationObserver(function(muts){
    muts.forEach(m=>{
      m.addedNodes.forEach(node=>{
        if(node.nodeType === Node.TEXT_NODE){
          sanitizeTextNode(node);
        } else if(node.nodeType === Node.ELEMENT_NODE){
          walkTextNodes(node, sanitizeTextNode);
        }
      });
    });
  });
  observer.observe(document.documentElement || document.body, {childList:true, subtree:true});

  function sanitizeBetInputs(){
    const inputs = Array.from(document.querySelectorAll('input[type="text"], input[type="number"], input:not([type])'));
    inputs.forEach(inp=>{
      const idn = (inp.id||'') + ' ' + (inp.name||'') + ' ' + (inp.className||'');
      if(/bet|wager|amount|apuesta|monto|stake|cantidad/i.test(idn)){
        inp.setAttribute('placeholder', 'Monto en ARS');
        inp.addEventListener('input', function(e){
          const v = inp.value || '';
          const num = toNumber(v);
          inp.value = formatARS(num);
        });
      }
    });

    const buttons = Array.from(document.querySelectorAll('button, a'));
    buttons.forEach(btn=>{
      const txt = (btn.textContent||'') + ' ' + (btn.id||'') + ' ' + (btn.className||'');
      if(/bet|apostar|apost|spin|jugar|play|stake/i.test(txt)){
        btn.addEventListener('click', function(e){
          let betInput = null;
          const parent = btn.closest('form, div, section, article') || document;
          const candidates = parent.querySelectorAll('input, textarea, [contenteditable="true"]');
          candidates.forEach(c=>{
            const idn = (c.id||'') + ' ' + (c.name||'') + ' ' + (c.className||'');
            if(/bet|wager|amount|apuesta|monto|stake|cantidad/i.test(idn) && !betInput) betInput = c;
          });
          if(!betInput){
            Array.from(parent.querySelectorAll('input')).forEach(c=>{
              if((c.type==='number' || c.type==='text') && !betInput) betInput = c;
            });
          }
          if(betInput){
            const num = toNumber(betInput.value || betInput.textContent || '');
            const final = (num <= 0) ? 1 : num;
            if(betInput.tagName === 'INPUT' || betInput.tagName === 'TEXTAREA'){
              betInput.value = formatARS(final);
            } else {
              betInput.textContent = formatARS(final);
            }
          }
          walkTextNodes(parent, sanitizeTextNode);
        }, {capture:true});
      }
    });
  }

  window.CasinoBalance = {
    get: function(){ return Number(localStorage.getItem(STORAGE_KEY)) || 0; },
    set: function(v){ writeStoredBalance(Number(v)||0); },
    add: function(v){ const cur = Number(localStorage.getItem(STORAGE_KEY))||0; writeStoredBalance(cur + Number(v||0)); },
    sub: function(v){ const cur = Number(localStorage.getItem(STORAGE_KEY))||0; writeStoredBalance(cur - Number(v||0)); },
    reloadFromAdmin: function(){ return fetchAndApplyAdmin(); }
  };

  // Initialize: fetch admin.json immediately, then poll
  fetchAndApplyAdmin().then(function(){
    updateAllDisplays();
    sanitizeBetInputs();
    setInterval(function(){
      fetchAndApplyAdmin().then(function(changed){
        if(changed !== null){
          console.info('admin.json updated, balance set to', changed);
        }
      });
      updateAllDisplays();
      sanitizeBetInputs();
    }, POLL_INTERVAL_MS);
  });
})();
</script>

</body>
</html>
